pipeline {
    agent any
     environment {
        KUBECONFIG = "${env.USERPROFILE}\\.kube\\config"
        KUBECTL_CONTEXT = 'minikube'
        MINIKUBE_HOME = "C:\\Users\\prasad"
    }

    stages {
        stage('Check Helm') {
            steps {
                script {
                    sh '''
                        set +x
                        helm version
                        helmfile version
                        minikube update-context
                        minikube status
                        pwd
                        ls -ltrh
                        cd root-constraint
                        helmfile -f helmfile_good.yaml sync
                        echo "Waiting for 10 seconds before validating pod"
                        sleep 10
                        echo "Calling python script to validate pod"
                        python pods.py gk-test good-pod-release
                    '''
                }
            }
        }
    }
}

