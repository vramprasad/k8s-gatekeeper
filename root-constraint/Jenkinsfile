pipeline {
    agent any
     environment {
        KUBECONFIG = "${env.USERPROFILE}\\.kube\\config"
        KUBECTL_CONTEXT = 'minikube'
        MINIKUBE_HOME = "C:\\Users\\prasad"
    }

    stages {
        stage('Check Helm') {
            steps {
                sh '''
                    set +x
                    helm version
                    helmfile version
                    minikube update-context
                    minikube status
                    pwd
                    ls -ltrh
                    cd root-constraint
                    kubectl get namespace | grep -q "gk-test" || kubectl create namespace gk-test
                    helmfile sync
                    kubectl get events --namespace gk-test
                '''
            }
        }
    }
}
